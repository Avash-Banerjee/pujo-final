{% extends 'base.html' %} {% block content %}
<div class="min-h-screen flex items-center justify-center px-4">
  <div class="max-w-md w-full">
    <a
      href="{{ url_for('landing') }}"
      class="flex items-center text-gray-600 hover:text-pink-600 mb-8 transition-colors"
    >
      <i data-lucide="arrow-left" class="h-5 w-5 mr-2"></i>
      Back to Home
    </a>

    <div class="bg-white/90 backdrop-blur-sm rounded-3xl shadow-2xl p-8">
      <div class="text-center mb-8">
        <i data-lucide="heart" class="h-12 w-12 text-pink-500 mx-auto mb-4"></i>
        <h2 class="text-3xl font-bold text-gray-900 mb-2">
          {{ 'Welcome Back' if mode == 'login' else 'Join LoveConnect' }}
        </h2>
        <p class="text-gray-600">
          {{ 'Sign in to continue your journey' if mode == 'login' else 'Create
          your account and find love today' }}
        </p>
      </div>

      {% with messages = get_flashed_messages(with_categories=true) %} {% if
      messages %} {% for category, message in messages %}
      <div
        class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4"
        role="alert"
      >
        <span class="block sm:inline">{{ message }}</span>
      </div>
      {% endfor %} {% endif %} {% endwith %}

      <form
        method="POST"
        action="{{ url_for(mode) }}"
        class="space-y-6"
        id="auth-form"
        novalidate
      >
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Email Address
          </label>
          <input
            type="email"
            name="email"
            required
            class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all"
            placeholder="Enter your email"
          />
          <p class="text-red-500 text-sm mt-1 error-message"></p>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Password
          </label>
          <div class="relative">
            <input
              type="password"
              name="password"
              id="password"
              required
              minlength="8"
              class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all pr-12"
              placeholder="Enter your password"
            />
            <button
              type="button"
              class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600"
              onclick="togglePasswordVisibility('password')"
            >
              <i data-lucide="eye" class="h-5 w-5"></i>
            </button>
          </div>
          <p class="text-red-500 text-sm mt-1 error-message"></p>
        </div>

        {% if mode == 'signup' %}
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Confirm Password
          </label>
          <div class="relative">
            <input
              type="password"
              name="confirm_password"
              id="confirm_password"
              required
              class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all pr-12"
              placeholder="Confirm your password"
            />
            <button
              type="button"
              class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600"
              onclick="togglePasswordVisibility('confirm_password')"
            >
              <i data-lucide="eye" class="h-5 w-5"></i>
            </button>
          </div>
          <p class="text-red-500 text-sm mt-1 error-message"></p>
        </div>
        {% endif %}

        <button
          type="submit"
          class="w-full py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-xl font-semibold hover:from-pink-600 hover:to-purple-700 transform hover:scale-105 transition-all shadow-lg"
        >
          {{ 'Sign In' if mode == 'login' else 'Create Account' }}
        </button>
      </form>

      <div class="mt-6 text-center">
        <p class="text-gray-600">
          {{ "Don't have an account? " if mode == 'login' else "Already have an
          account? " }}
          <a
            href="{{ url_for('signup') if mode == 'login' else url_for('login') }}"
            class="text-pink-600 hover:text-pink-700 font-semibold"
          >
            {{ 'Sign up' if mode == 'login' else 'Sign in' }}
          </a>
        </p>
      </div>
    </div>
  </div>
</div>

<script>
  function togglePasswordVisibility(fieldId) {
    const input = document.getElementById(fieldId);
    const icon = input.nextElementSibling.querySelector("i");
    if (input.type === "password") {
      input.type = "text";
      icon.setAttribute("data-lucide", "eye-off");
    } else {
      input.type = "password";
      icon.setAttribute("data-lucide", "eye");
    }
    lucide.createIcons();
  }

  document.getElementById("auth-form").addEventListener("submit", function (e) {
    const form = e.target;
    let isValid = true;

    // Clear previous errors
    form
      .querySelectorAll(".error-message")
      .forEach((el) => (el.textContent = ""));
    form
      .querySelectorAll("input")
      .forEach((el) => el.classList.remove("border-red-500"));

    const email = form.querySelector('[name="email"]');
    if (!email.value) {
      isValid = false;
      email.nextElementSibling.textContent = "Email is required";
      email.classList.add("border-red-500");
    } else if (!/\S+@\S+\.\S+/.test(email.value)) {
      isValid = false;
      email.nextElementSibling.textContent = "Email is invalid";
      email.classList.add("border-red-500");
    }

    const password = form.querySelector("#password");
    if (!password.value) {
      isValid = false;
      password.parentElement.nextElementSibling.textContent =
        "Password is required";
      password.classList.add("border-red-500");
    } else if (password.value.length < 8) {
      isValid = false;
      password.parentElement.nextElementSibling.textContent =
        "Password must be at least 8 characters";
      password.classList.add("border-red-500");
    }

    if (form.querySelector("#confirm_password")) {
      const confirmPassword = form.querySelector("#confirm_password");
      if (!confirmPassword.value) {
        isValid = false;
        confirmPassword.parentElement.nextElementSibling.textContent =
          "Please confirm your password";
        confirmPassword.classList.add("border-red-500");
      } else if (password.value !== confirmPassword.value) {
        isValid = false;
        confirmPassword.parentElement.nextElementSibling.textContent =
          "Passwords do not match";
        confirmPassword.classList.add("border-red-500");
      }
    }

    if (!isValid) {
      e.preventDefault();
    }
  });
</script>
{% endblock %}
